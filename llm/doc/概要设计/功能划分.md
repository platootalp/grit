# 功能划分

## 1.模型

| 功能大类        | 关键子功能            | 说明 & 场景                                                       |
|-------------|------------------|---------------------------------------------------------------|
| **模型注册与配置** | **模型创建**         | 名称、描述、类型、版本、Base URL、Key、参数默认值…                               |
|             | **版本管理**         | 支持同一模型多版本共存，灰度发布、回滚；给智能体绑定版本别名（如 *latest*）                    |
|             | **安全凭据管理**       | Key / Token 加密存储 & 周期轮换；支持多租户隔离                               |
| **模型供应商管理** | **供应商目录**        | 内置厂商 & 第三方市场；标注计费方式、可用区域、支持能力                                 |
|             | **兼容性适配器库**      | 针对每个供应商维护 Adapter 模块（统一成 chat / completion / embedding 等标准接口） |
| **能力与健康**   | **能力声明 / 校验**    | 上下文长度、Tool Calling、图文、音频、RAG、函数调用等；保存为 `Capability` 对象        |
|             | **健康监测**         | 调用成功率、延迟、超时、错误码；自动打“**健康 / 降级 / 不可用**”标签，供路由层决策               |
|             | **沙箱测试**         | 在正式接入前自动跑一组探针用例，验证兼容性与限速                                      |
| **调用与调度**   | **统一调用接口**       | `chatCompletion() / text2img() / speechToText()`…             |
|             | **限流与配额**        | 单模型 / 单用户 / 单项目维度；与计费域对接                                      |
|             | **路由标签 & 权重**    | 供“模型路由域”读取：如 `primary`, `backup`, `cheap`, `fast`             |
| **运维与指标**   | **调用指标上报钩子**     | 为支撑域的日志 / 监控子域提供埋点：耗时、token 数、成本、错误                           |
|             | **成本模型**         | 为计费域提供 *单 token 或单请求* 成本基准，便于费用估算                             |
| **生命周期治理**  | **启用 / 停用 / 归档** | 停用模型后自动阻断调用；归档只读保留历史                                          |
|             | **合规与数据政策**      | 标注“是否允许发送 PII / 企业数据”；供智能体或 RAG 调用前校验                         |

### 典型工作流示例

1. **接入新模型**
   供应商管理 → 创建供应商条目 → 上传适配器 → 沙箱探针 → 能力校验 → 进入“健康”状态
2. **用户自定义模型**
   用户在 UI 填写 Base URL + Key → 模型注册 → 限速额度 = 默认 100 req/min → 私有可见
3. **在线切流 / 回滚**
   发布 *v2* 版本 → 给智能体设置路由标签 `canary` → 监控失败率 > 阈值 → 路由域自动 fallback 到 *v1*

## 2.知识库

### 创建知识库

| 功能点    | 描述                                  |
|--------|-------------------------------------|
| 基本信息   | 设置知识库名称、描述、图标                       |
| 访问权限   | 设置知识库的访问权限（公开/私有）                   |
| 导入内容   | 导入内容数据（本地文件、网页）                     |
| 设置分段   | 设置分段模式（通用模式、父子模式），设置分段规则（分段长度、分段重叠） |
| 分段结果预览 | 预览分段结果                              |
| 设置索引方法 | 设置索引方法（向量索引、全文索引）                   |

### 管理知识库

| 功能点      | 描述                                  |
|----------|-------------------------------------|
| 基本信息管理   | 管理知识库名称、描述、图标、访问权限、索引方法、embedding模型 |
| 文档管理     | 管理知识库中的文档（增删改查)、状态控制（启用/禁用）         |
| 查看文档详情   | 查看文档详情（元数据、分段结果）                    |
| 管理文档分段信息 | 管理文档分段信息（增删改查）                      |

### 元数据管理

| 功能点        | 描述               |
|------------|------------------|
| 字段定义       | 名、类型、值、数量        |
| 管理知识库元数据字段 | 管理知识库元数据字段（增删改查） |
| 管理文档元数据    | 管理文档元数据（增删改查）    |

### 集成到应用中

| 功能大类      | 子功能点 | 描述                                 |
|-----------|------|------------------------------------|
| 关联应用      | 召回设置 | 设置检索参数（topK、分数阈值），支持向量检索、全文检索、混合检索 |
| 使用元数据筛选知识 | 添加条件 | 元数据字段、运算符、值                        |                 
|           | 组合条件 | 且、或、非                              |
|           | 保存条件 | 保存为常用筛选条件                          |

### 知识库检索

| 功能点 | 描述      |
|-----|---------|
|     | 检索知识库内容 |

## 3.插件

插件域（Plugin Domain）在大模型平台中，负责 **对接外部工具、服务、系统**，是智能体功能拓展的重要途径。它通常包括 *
*插件注册、权限控制、参数定义、执行环境、调用桥接** 等功能。以下是插件域的推荐功能划分：

### ✅ 一、插件管理

| 功能项     | 描述                                  |
|---------|-------------------------------------|
| 插件注册    | 注册插件的元信息（名称、描述、能力说明、Schema、调用方式等）   |
| 插件分类    | 按功能类型对插件分类，如数据类、推理类、工具类             |
| 插件配置    | 每个插件的认证信息（API key、token、endpoint）管理 |
| 插件状态管理  | 启用/禁用、调试状态、版本信息管理                   |
| 插件测试与调试 | 提供调试接口，校验参数是否匹配、是否可调用成功             |
| 插件文档管理  | 插件的使用文档、示例 Prompt、返回结构说明等           |

---

### ✅ 二、插件执行框架（插件运行时）

| 功能项        | 描述                                               |
|------------|--------------------------------------------------|
| 插件调用适配器    | 将调用标准化为统一格式（如 OpenAPI、函数调用、gRPC、Python Function） |
| 参数构造与上下文注入 | 支持从对话上下文中提取参数并注入插件调用                             |
| 插件调用调度器    | 控制调用流程（串行、并行、失败重试、fallback）                      |
| 调用日志与调用链追踪 | 记录每次插件调用的输入/输出、耗时、状态                             |
| 异常处理与降级策略  | 插件调用失败时，支持默认返回值、提示、fallback 插件等处理方式              |
| 返回结果规范化    | 插件返回结果转为统一 JSON 结构，供上层 Prompt/模型使用               |

---

### ✅ 三、插件能力分类（插件类型）

| 插件类型           | 描述                         | 示例                                    |
|----------------|----------------------------|---------------------------------------|
| 🌐 外部 API 插件   | 接入三方 REST 接口               | 天气、翻译、搜索、股票等                          |
| 🔧 工具函数插件      | 平台封装的工具类 Function          | 正则解析、日期处理、数据清洗等                       |
| 📊 数据访问插件      | 连接数据库、ElasticSearch、S3 等存储 | MySQL 查询、文件下载                         |
| 🧠 推理增强插件      | 调用向量检索、rerank、embedding 模型 | `embedding()`, `rerank()`             |
| 🧠 Prompt 构造插件 | 按模板生成 Prompt，或提取上下文片段      | `build_prompt()`, `extract_context()` |
| 🔗 MCP 协议插件    | 对外部模型能力或上下文构建能力的封装         | `call_mcp_function()`，如上下文拼接、模型调用包装器  |

---

### ✅ 四、权限与调用控制

| 功能项        | 描述                       |
|------------|--------------------------|
| 插件权限控制     | 每个智能体或用户能否访问某插件，是否有调用权限  |
| 插件调用次数控制   | 限流、频控（如每日调用上限）           |
| API Key 管理 | 针对私有插件，支持按用户配置密钥         |
| 安全沙箱与隔离执行  | 插件调用应限制可访问资源、执行权限，避免安全风险 |

---

### ✅ 五、插件集成与工作流

| 功能项               | 描述                                          |
|-------------------|---------------------------------------------|
| 与智能体/工作流绑定        | 可将插件绑定到某 Agent 的某个节点                        |
| 插件调用结果入 Prompt    | 插件执行结果可作为 Prompt 的输入变量                      |
| 插件多步串联与分支控制       | 在复杂工作流中组合多个插件并按条件分支执行                       |
| 与模型动态交互（ToolCall） | 支持与 LLM 动态交互的插件调用，如 OpenAI function call 风格 |

---

### ✅ 六、典型插件调用协议格式（MCP 类）

```jsonc
{
  "name": "rerank_documents",
  "type": "function",
  "input_schema": {
    "query": "string",
    "documents": ["string"]
  },
  "output_schema": {
    "reranked": [
      {
        "doc": "string",
        "score": "float"
      }
    ]
  },
  "call_url": "https://mcp.example.com/rerank",
  "auth": {
    "type": "bearer_token",
    "token": "{{plugin_token}}"
  }
}
```

---

### 🟢 总结：插件域的完整结构

```text
┌───────────────┐
│     插件管理中心     │
├───────────────┤
│ 插件注册/配置/分类     │
│ 权限管理 & 状态控制    │
│ 示例文档 & 参数验证    │
└──────┬────────┘
       │
┌──────▼────────┐
│     插件执行框架     │
├───────────────┤
│ 参数构造 & 上下文注入 │
│ 调用调度 & 返回处理   │
│ 错误处理 & 日志追踪   │
└──────┬────────┘
       │
┌──────▼────────┐
│     插件类型分类     │
├───────────────┤
│ API 插件           │
│ 工具函数插件         │
│ 推理增强插件（含 MCP）│
│ 数据访问插件         │
│ Prompt 构造插件      │
└────────────────┘
```

### 🌟 与其他域的协作关系：

* 与 **模型域** 结合实现 Tool Calling（模型自动调用插件）
* 与 **智能体域** 集成，用户可为每个 Agent 配置可用插件
* 与 **计费域** 对接，插件调用可产生额外费用
* 与 **监控域** 对接，监控插件调用耗时、错误率

## 4.智能体

### 创建智能体

设置智能体名称、描述、头像、提示词、模型、知识库、工具、设置（最大迭代次数）等

- 添加提示词
- 添加开场白
- 添加知识库
- 添加需要的工具

### CURD智能体

基本管理能力

### 调试和预览智能体

加载历史对话信息、和智能体对话，引用的知识库文档

### 发布与渠道集成

将智能体发布到应用市场或者其他三方服务

### 版本管理

类似于 Git tag 的机制，便于回滚和发布稳定版本

| 功能点    | 描述                   |
|--------|----------------------|
| 历史版本管理 | 保存历史版本并可预览或回滚        |
| 发布版本标识 | 显示“当前发布版本”或“正在编辑中版本” |

### 导出 / 导入

方便用户迁移、备份或分享智能体

| 功能点  | 描述                        |
|------|---------------------------|
| 导出配置 | 将 Agent 导出为 JSON/YAML/PDF |
| 导入配置 | 上传配置并创建新 Agent            |

### 生命周期与状态管理

提供 Agent 状态信息以便管理与运营

| 功能点    | 描述                        |
|--------|---------------------------|
| 状态标记   | 草稿、已发布、下架、异常等状态           |
| 生命周期管理 | 设置 Agent 的上线/下线时间，自动过期策略等 |

### 权限与协作机制

适用于团队协作型平台或企业使用场景

| 功能点  | 描述                                      |
|------|-----------------------------------------|
| 权限控制 | 谁可以查看、编辑、调试、发布该 Agent                   |
| 协作机制 | 支持多人协同开发一个智能体（如 Notion 或 GitBook 的协作机制） |

### 运行时监控与日志

帮助用户排查运行中问题

| 功能点    | 描述                    |
|--------|-----------------------|
| 对话调用日志 | 查看某次用户与智能体交互的完整上下文与响应 |
| 模型调用详情 | 展示请求体、响应体、token 消耗等信息 |
| 错误分析   | 显示运行错误及定位建议           |

## 5.工作流

## 6.应用

## 7.发布

## 8.市场
