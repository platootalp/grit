# 📘 领域驱动设计（DDD）设计流程全景图

领域驱动设计（Domain-Driven Design，DDD）是一种聚焦业务领域的建模方法论，核心在于通过与领域专家深度协作，持续迭代领域模型，以驱动高内聚、低耦合的软件系统架构。

---

## 🧭 一、战略设计（Strategic Design）

### 1. **领域探索（Domain Exploration）**

> 理解业务，建立“通用语言”。

* **目标**：构建开发与业务之间共享的语言系统（Ubiquitous Language），统一术语，避免歧义。
* **方法**：事件风暴（Event Storming）、领域专家访谈、业务流程图。
* **产出**：领域事件清单、业务流程阶段划分、术语词汇表、概念关系图。

---

### 2. **子域识别（Subdomain Identification）**

> 找出业务系统的关键结构并分类。

* **分类方式**：

  * 🌟 **核心子域（Core Domain）**：最具业务价值，是企业竞争优势所在；
  * 🛠️ **支撑子域（Supporting Domain）**：辅助核心域运作，如审核、报表；
  * ⚙️ **通用子域（Generic Domain）**：如认证、日志等可复用能力。
* **产出**：子域列表及优先级评估。

---

### 3. **限界上下文划分（Bounded Context）**

> 明确模型边界，避免模型污染。

* **定义**：每个限界上下文是一个自洽的模型空间，有独立语言、职责与接口。
* **映射方式**：共享内核、上下文映射图、反腐层（ACL）等。
* **产出**：限界上下文边界图（Context Map），团队分工与上下文集成关系。

---

## 🧩 二、战术设计（Tactical Design）

### 4. **领域建模（Domain Modeling）**

> 使用战术建模模式构建领域模型。

* **建模元素**：

  * **聚合（Aggregate）**：事务一致性边界；
  * **聚合根（Aggregate Root）**：聚合入口，唯一对外公开；
  * **实体（Entity）**：具备唯一标识的业务对象；
  * **值对象（Value Object）**：无唯一标识，按值判等；
  * **领域服务（Domain Service）**：无法归属实体的领域逻辑；
* **产出**：领域类图、行为方法、模型说明文档。

```java
class Order {
    private OrderId id;
    private List<OrderItem> items;
    private Customer customer;
    private OrderStatus status;

    public void confirm() { ... } // 聚合根行为
}
```

---

### 5. **应用服务（Application Service）与协调**

> 组织流程但不承载业务规则。

* **职责**：

  * 协调多个聚合和领域服务；
  * 实现事务管理与安全控制；
* **产出**：服务接口定义、业务流程调用图。

---

### 6. **基础设施层（Infrastructure Layer）**

> 提供持久化、通信、缓存等技术支持。

* **特性**：

  * 不包含业务逻辑；
  * 依赖反转注入领域层；
* **产出**：数据库适配器、MQ 消息发送器、接口客户端等。

---

### 7. **上下文集成与通信（Integration）**

> 限界上下文之间集成。

* **方式**：

  * 领域事件（Domain Event）；
  * 消息队列、REST API；
  * 反腐层（Anti-Corruption Layer）；
* **产出**：集成事件定义、事件发布机制、接口契约文档。

---

## 🔁 三、持续演进与重构

### 8. **验证与反馈（Validation & Iteration）**

> 快速验证模型是否真实反映业务。

* **方法**：示例用例、行为驱动测试（BDD）、与专家对拍；
* **产出**：修订模型版本、增强词汇表、模型行为测试覆盖。

---

### 9. **模型持续优化（Continuous Evolution）**

> 模型与业务共同演化。

* **手段**：

  * 重构聚合边界；
  * 更新通用语言；
  * 应对组织架构或业务流程变化；
* **产出**：版本演进模型文档、重构后的代码、变更记录。

---

## 📌 总结：DDD 落地路径图

```text
领域探索（通用语言 + 事件风暴）
     ↓
子域识别（核心 / 支撑 / 通用）
     ↓
限界上下文划分（Context Map）
     ↓
领域建模（聚合 + 服务 + 值对象）
     ↓
应用服务编排
     ↓
基础设施实现
     ↓
上下文之间通信与防腐
     ↓
验证反馈 + 持续演进
```
